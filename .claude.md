# TinyDependency 项目说明

## 项目概述

TinyDependency 是一个轻量级的 Swift 依赖注入库，专为 SwiftUI 项目中的非视图场景设计。

## 核心设计原则

1. **类似 SwiftUI.Environment 的 API**: 提供熟悉的声明式语法
2. **强制 Sendable 约束**: 所有依赖值必须遵循 Sendable，确保并发安全
3. **三种作用域**: `default`、`test`、`preview`
4. **基于 @TaskLocal**: 利用 Swift 并发模型实现作用域隔离
5. **轻量级**: 零第三方依赖，纯 Swift 实现

## 技术要求

- Swift 6.0+
- 启用严格并发检查 (StrictConcurrency)
- 最低平台版本: iOS 16, macOS 13, tvOS 16, watchOS 9, visionOS 1

## 架构设计

### 核心组件

1. **DependencyKey**: 定义依赖键的协议，包含三种作用域的值
2. **DependencyValues**: 依赖容器，使用 @TaskLocal 实现
3. **@Dependency**: PropertyWrapper，提供便捷访问
4. **withDependencies**: 测试闭包，用于临时覆盖依赖

### 使用示例

```swift
// 定义依赖键
private struct LoggerKey: DependencyKey {
    static let defaultValue: Logger = ProductionLogger()
    static let testValue: Logger = MockLogger()
    static let previewValue: Logger = PreviewLogger()
}

// 扩展容器
extension DependencyValues {
    var logger: Logger {
        get { self[LoggerKey.self] }
        set { self[LoggerKey.self] = newValue }
    }
}

// 使用依赖
class Service {
    @Dependency(\.logger) var logger
}

// 测试覆盖
withDependencies {
    $0.logger = CustomLogger()
} operation: {
    // 测试代码
}
```

## 编码规范

- 遵循 Swift 6 最新特性
- 所有公开 API 必须有文档注释
- 使用 SwiftLint 规范
- 保持代码简洁，优先考虑并发安全
